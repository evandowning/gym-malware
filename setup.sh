#!/bin/bash

# If anaconda has not yet been installed
if [ ! -d "/root/anaconda3/" ]; then
    # Download Anaconda3
    wget https://repo.anaconda.com/archive/Anaconda3-2020.07-Linux-x86_64.sh

    # Run Anaconda setup
    bash ./Anaconda3-2020.07-Linux-x86_64.sh -b -p /root/anaconda3/
    source /root/anaconda3/bin/activate
    conda init
    source ~/.bashrc

    # Update Anaconda
    conda update conda -y
fi

source ~/.bashrc

# Install upx
if [[ $(id -u) -ne 0 ]]; then
    sudo apt install -y upx
else
    apt install -y upx
fi

# Setup gym-malware
conda create -n gym python=3.6 anaconda -y
conda activate gym
conda install --yes libgcc
conda install --yes -c conda-forge ruamel.yaml
pip install -r requirements.txt
python setup.py install

conda deactivate
